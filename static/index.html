<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Runeterra's food emporium</title>
</head>
<body>
<div id="app">
    <router-view></router-view>
</div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.6.1/css/ol.css" type="text/css">
<script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.6.1/build/ol.js"></script>
<script src="frontLib/vue.js"></script>
<script src="frontLib/vue-router.js"></script>
<script src="frontLib/axios.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous" />
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-eMNCOe7tC1doHpGoWe/6oMVemdAVTMs2xqW4mwXrXsW0L84Iytr2wi5v2QjrP/xp" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js" integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/" crossorigin="anonymous"></script>
<script src="frontLib/httpVueLoader.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
<script src="frontLib/toast.js"></script></body>
<script>

    Vue.component('custom-nav-bar', httpVueLoader('Components/NavBar.vue'));
    const routes = [
        {
            path: '/',
            beforeEnter: (to, from, next) => {
                if (localStorage.jws) {
                    axios.get('/user/role', {headers:{'Authorization': 'Bearer' + localStorage.jws}})
                    .then(r => {
                        if(r.data == 'Regular'){
                            next({name: 'Home'});
                        }else if(r.data == 'Admin'){
                            next({path: '/admin'});
                        }else if(r.data == 'Manager'){
                            next({path: '/manager'});
                        }else{
                            next({name: 'Home'});
                        }
                    }).catch( ()=> next({name:'Home'}));
                    next({name: 'Home'});
                } else {
                    next({name: 'Home'});
                }
            },
        },
        {
            path:'/home',
            name: 'Home',
            component: httpVueLoader('views/Home.vue'),
        },
        {
            path: '/signin',
            name: 'Signin',
            component: httpVueLoader('views/Signin.vue'),
        },
        {
            path: '/profile',
            name: 'Profile',
            component: httpVueLoader('views/Profile.vue'),
        },
        {
            path:'/admin',
            component: httpVueLoader('views/Admin.vue'),
            children:[
                {
                    path:'',
                    name: 'UsersViewAdmin',
                    component: httpVueLoader('views/UsersViewAdmin.vue'),
                },
                {
                  path: 'newrestaurant',
                  name: 'NewRestaurant',
                  component:  httpVueLoader('views/NewRestaurant.vue'),
                },
                {
                    path: 'newuser',
                    name: 'NewUser',
                    component: httpVueLoader('views/NewUser.vue'),
                },
            ],
        },
        {
            path:'/manager',
            component: httpVueLoader('views/Manager.vue'),
            children:[
                {
                    path:'',
                    name: 'ManagerRestaurant',
                    component: httpVueLoader('views/ManagerRestaurant'),
                },
                {
                    path: 'restaurantorders',
                    name: 'RestaurantOrders',
                    component:  httpVueLoader('views/RestaurantOrders.vue'),
                },
                {
                    path: 'customers',
                    name: 'Customers',
                    component: httpVueLoader('views/Customers.vue'),
                },
            ],
        },



    ];

    const router = new VueRouter({
        routes: routes,
    })

    new Vue({
        el: '#app',
        router: router,
        methods: {

        }
    }).$mount('#app')
</script>

</html>